---
- name: Add mariadb repo key
  apt_key: url=http://keyserver.ubuntu.com/pks/lookup?op=get&search=0xcbcb082a1bb943db state=present

- name: Add mariadb repo
  apt_repository: repo='deb http://mirror.netcologne.de/mariadb/repo/10.1/ubuntu xenial main'

- name: Install mariadb
  apt: name={{item}} update_cache=yes state=latest cache_valid_time=86400
  with_items:
    - mariadb-client
    - libmariadbclient-dev
    - python-mysqldb

- name: create db directory
  file: path={{ mariadb_data }} mode=770 state=directory

- name: start mariadb
  docker:
    name: mariadb
    image: mariadb:latest
    state: started
    pull: missing
    restart_policy: always
    ports:
    - 3306:3306
    volumes:
    - "{{ mariadb_data }}:/var/lib/mysql"
    env:
      MYSQL_ROOT_PASSWORD: "{{ mariadb_pw }}"
